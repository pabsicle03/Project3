<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ordering Trends</title>
    <link rel="stylesheet" href="../manager.css">
</head>

<body>
    <header class="top-bar">
        <button class="nav-pill active"><a href="orderingtrends.html">Ordering Trends</a></button>
        <button class="nav-pill"><a href="inventory.html">Inventory</a></button>
        <button class="nav-pill"><a href="employee.html">Employee</a></button>
        <button class="nav-pill"><a href="productusage.html">Product Usage</a></button>
        <button class="nav-pill"><a href="xreport.html">X-Report</a></button>
        <button class="nav-pill"><a href="zreport.html">Z-Report</a></button>
        <button class="nav-pill"><a href="itemedits.html">Item Edits</a></button>

        <button class="nav-pill exit"><a href="../startpage.html">Exit Manager View</a></button>
    </header>

    <section class="panel">

        <h1 class="page-title">Ordering Trends</h1>

        <p class="text-line"><strong>Most Ordered Item:</strong> <span id="mostOrdered">Loading...</span></p>
        <p class="text-line"><strong>Least Ordered Item:</strong> <span id="leastOrdered">Loading...</span></p>
        <p class="text-line"><strong>Total Revenue Made:</strong> $<span id="totalRevenue">Loading...</span></p>

        <div class="content-flex">
            <!-- Pie chart -->
            <!-- Line chart -->
        </div>

    </section>

    <script>
        // Fetch ordering trends from backend
        async function loadOrderingTrends() {
            try {
                const res = await fetch("/api/manager/orderingtrends");
                const data = await res.json();

                if (!data.ok) throw new Error(data.error || "Failed to fetch");

                // Populate placeholders
                document.getElementById("mostOrdered").textContent = `${data.mostOrdered.drink_name} (${data.mostOrdered.count})`;
                document.getElementById("leastOrdered").textContent = `${data.leastOrdered.drink_name} (${data.leastOrdered.count})`;

                const totalRevenue = data.revenue.reduce((sum, r) => sum + Number(r.revenue), 0);
                document.getElementById("totalRevenue").textContent = totalRevenue.toFixed(2);

                // Optional: you can also build charts with data.revenue
                // e.g., a pie chart of top 10 revenue drinks
            } catch (err) {
                console.error("Error loading ordering trends:", err);
                document.getElementById("mostOrdered").textContent = "Error";
                document.getElementById("leastOrdered").textContent = "Error";
                document.getElementById("totalRevenue").textContent = "Error";
            }
        }

        // Run on page load
        document.addEventListener("DOMContentLoaded", loadOrderingTrends);
    </script>
</body>
</html>
